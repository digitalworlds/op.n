<!DOCTYPE html>
<html>
<head>
	<title>op.n</title>
	<meta charset="utf-8"/>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
	
	<style>
        @-ms-viewport { width: 100vw ; min-zoom: 100% ; zoom: 100% ; }          @viewport { width: 100vw ; min-zoom: 100%; zoom: 100% ; }
        @-ms-viewport { user-zoom: fixed ; min-zoom: 100% ; }                   @viewport { user-zoom: fixed ; min-zoom: 100% ; }
	</style>
	<script type="text/javascript" src="js/opn.js"></script>
	<script type="text/javascript">
	var my_program=function()
	{
		if(opn.static && (location.search.indexOf('?file/')==0||location.search.indexOf('?app/')==0))
		{
			let loadapp=()=>{
				if(oid.indexOf('@')==-1)oid=oid+'@'+opn.cloudhost;
				
				opn.cloud.getObject(oid).whenReady().then((o)=>{
					document.title=o.getSystemProperty('NAME');
					let icon=o.getSystemProperty('ICON');
					if(icon){
						let links=document.getElementsByTagName('link');
						for(let i=0;i<links.length;i++)links[i].href=o.id.getIconURL();
					}
					new opn.App().load(opn.viewers['OS']).then((Assets)=>{
						let os=new Assets.opnOS({parentDiv:opn.getScreen()});	
						
						let app=null;
						
						if(command.indexOf('/code')==0){
							app=os.openApp({initapp:true,appID:opn.viewers['Code'],input:o});
						}
						else if(command.indexOf('/api')==0){
							app=os.openApp({initapp:true,appID:opn.viewers['API'],input:oid});
						}else{
							
							if(o.getSystemProperty('OPEN')){
								app=os.openApp({initapp:true,appID:o.getSystemProperty('OPEN'),input:oid});
							} else if (o.getSystemProperty('CLASS')){
								let c=o.getSystemProperty('CLASS');
								if(c=='List'){
									app=os.openApp({initapp:true,appID:opn.viewers['List'],input:oid});
								}else if(c=='Image'){
									app=os.openApp({initapp:true,appID:opn.viewers['Image'],input:oid});
								}else if(c=='User'){
									app=os.openApp({initapp:true,appID:opn.viewers['User'],input:oid});
								}else{
									app=os.openApp({initapp:true,fullscreen:embed,appID:oid});
								}
							}
							else {
								app=os.openApp({initapp:true,fullscreen:embed,appID:oid});
							}
						}
						app.getWindow().maximize();
					});
				}).otherwise(()=>{
					console.log('This object is not available');
				});
			}
			var command='';
			var oid='';
			var embed=false;
			if(location.search.indexOf('?file/')==0)
			{
				let end=location.search.indexOf('/',6);
				if(end==-1)end=undefined;
				else command=location.search.substring(end);
				if(command.indexOf('/embed')==0)embed=true;
				oid=location.search.substring(6,end);
				loadapp();
			}else if(location.search.indexOf('?app/')==0)
			{
				let end=location.search.indexOf('/',5);
				if(end==-1)end=undefined;
				else command=location.search.substring(end);
				if(command.indexOf('/embed')==0)embed=true;
				let app_name=location.search.substring(5,end);
				opn.http(location.href.substring(0,location.href.indexOf('?'))+'apps/'+app_name).then((request)=>{
					oid=request.responseText.split("\n")[0];
					loadapp();
				})
			}
			return;
		}
		if(opn.redirectServerSite){location.href=opn.redirectServerSite;return}
		new opn.App().load(opn.landing);	
	}
	</script>
</head>
<body onload="opn.run(my_program,{loadingLogo:true})" style="margin:0px;background:#fff;color:#888;"></body>
</html>